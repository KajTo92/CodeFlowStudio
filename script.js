const translations = {
  en: {
    nav: {
      portfolio: "Portfolio",
      pricing: "Pricing",
      process: "Process",
      about: "About",
      contact: "Contact",
    },
    hero: {
      eyebrow: "AI-native digital experiences",
      title: "Launch a breathtaking website faster than ever..",
      lead: "CodeFlow Studio crafts ultra-modern web experiences that convert. Collaborate with me for a polished one-off build or an ongoing AI fueled iteration loop.",
      ctaPrimary: "Start your project",
      ctaSecondary: "View my work",
      offerOne: "Launch-ready site from 499 CHF",
      offerTwo: "Subscription from 49 CHF/month",
    },
    portfolio: {
      eyebrow: "Selected work",
      title: "Recent AI-assisted product launches.",
      lovana: "Dating assistant app driven by AI designed to improve your dating experiences. First messages generator, profile analyzer and many more ",
      teamvote: "Real-time voting beast for medium-large teams and companies. Live onscreen results simply by scanning a qr code from your phone",
      caseStudy: "Case study",
    },
    pricing: {
      eyebrow: "Transparent pricing",
      title: "Choose a launch or a living, breathing product relationship.",
      projectBadge: "Project Launch",
      projectTitle: "One-time build",
      projectPrice: "499 CHF · fixed",
      projectFeatures: [
        "Tailored concept, UX, and UI crafted with AI co-pilots",
        "Responsive, high-performing site ready to deploy within days",
        "Analytics, SEO foundation, and accessibility baked in",
      ],
      projectCTA: "Reserve your slot",
      subscriptionBadge: "Continuous Evolution",
      subscriptionTitle: "Subscription",
      subscriptionPrice: "49 CHF · monthly",
      subscriptionFeatures: [
        "Unlimited iterative updates and experiments",
        "AI-driven content generation and conversion optimization",
        "Priority support, hosting guidance, and performance checks",
      ],
      subscriptionCTA: "Join the waitlist",
    },
    process: {
      eyebrow: "How it works",
      title: "From spark to shipping in three moves.",
      steps: [
        {
          title: "Discovery + Preview",
          copy: "Share your goals and aesthetic. Receive a complimentary AI-backed concept preview so you can feel the direction before committing.",
        },
        {
          title: "Design + Build",
          copy: "I orchestrate design systems, motion, and code in a modular stack ready for launch. Expect updates within fast iterations.",
        },
        {
          title: "Launch + Iterate",
          copy: "Deploy with confidence and keep evolving. AI insights drive improvements, and I stay on to iterate or hand over seamlessly.",
        },
      ],
    },
    about: {
      eyebrow: "About me",
      title: "Jan Rejnowicz — crafting human experiences with AI precision.",
      copy: [
        "I’m an AI-native developer and designer. CodeFlow Studio blends state-of-the-art automation with meticulous human taste to ship products that feel both futuristic and unmistakably personal.",
        "I partner with founders, agencies, and teams that want to move fast without sacrificing craft. Let’s co-create something that feels alive.",
      ],
      stats: [
        { label: "Projects shipped", value: "40+" },
        { label: "AI automations deployed", value: "120+" },
        { label: "Avg. turnaround", value: "7 days" },
      ],
    },
    contact: {
      eyebrow: "Let’s build",
      title: "Ready for a site that feels alive from the first scroll?",
      copy: "Send a message with your idea, target audience, and timeline. I’ll respond within 24 hours with the free preview concept and next steps.",
      calendar: "Book a discovery call",
    },
    footer: {
      copy: "© CodeFlow Studio. Built with passion and AI.",
      backToTop: "Back to top",
    },
  },
  de: {
    nav: {
      portfolio: "Portfolio",
      pricing: "Preise",
      process: "Ablauf",
      about: "Über mich",
      contact: "Kontakt",
    },
    hero: {
      eyebrow: "AI-native digitale Experiences",
      title: "Starte eine beeindruckende Website, angetrieben von den neuesten AI-Workflows.",
      lead: "CodeFlow Studio erschafft ultra-moderne Web-Erlebnisse, die konvertieren. Arbeite mit mir für einen glänzenden Einzelauftrag oder einen laufenden AI-gestützten Verbesserungszyklus.",
      ctaPrimary: "Projekt anfragen",
      ctaSecondary: "Meine Arbeiten ansehen",
      offerOne: "Launch-fertige Website ab 499 CHF",
      offerTwo: "Abo ab 49 CHF pro Monat",
    },
    portfolio: {
      eyebrow: "Ausgewählte Arbeiten",
      title: "Aktuelle AI-unterstützte Produktlaunches.",
      lovana: "Ein Wellness-Begleiter, der achtsame Rituale mit prädiktiver AI für persönliche Journeys verbindet.",
      teamvote: "Plattform für Entscheidungen in verteilten Teams mit adaptiven, AI-gestützten Insights.",
      caseStudy: "Case Study",
    },
    pricing: {
      eyebrow: "Transparente Preise",
      title: "Wähle zwischen Launch oder einer lebendigen Produktpartnerschaft.",
      projectBadge: "Projekt Launch",
      projectTitle: "Einmalige Umsetzung",
      projectPrice: "499 CHF · Fixpreis",
      projectFeatures: [
        "Individuelles Konzept, UX und UI mit AI-Co-Piloten entwickelt",
        "Responsiver, performanter Auftritt ready to deploy in wenigen Tagen",
        "Analytics, SEO-Fundament und Accessibility inklusive",
      ],
      projectCTA: "Slot reservieren",
      subscriptionBadge: "Kontinuierliche Evolution",
      subscriptionTitle: "Subscription",
      subscriptionPrice: "49 CHF · monatlich",
      subscriptionFeatures: [
        "Unlimitierte Iterationen und Experimente",
        "AI-gestützte Inhalte und Conversion-Optimierung",
        "Priorisierter Support, Hosting-Guidance und Performance-Checks",
      ],
      subscriptionCTA: "Auf Warteliste setzen",
    },
    process: {
      eyebrow: "So läuft es",
      title: "Von der Idee zum Launch in drei Phasen.",
      steps: [
        {
          title: "Discovery + Preview",
          copy: "Teil deine Ziele und Ästhetik. Erhalte ein kostenloses AI-gestütztes Konzept-Preview, bevor du dich festlegst.",
        },
        {
          title: "Design + Build",
          copy: "Ich komponiere Designsysteme, Motion und Code in einem modularen Stack – launchbereit in schnellen Iterationen.",
        },
        {
          title: "Launch + Iterate",
          copy: "Starte mit Sicherheit und entwickle weiter. AI-Insights treiben Optimierungen, und ich bleibe für Iterationen oder Handover an Bord.",
        },
      ],
    },
    about: {
      eyebrow: "Über mich",
      title: "Jan Rejnowicz — humanes Erlebnis, AI-Präzision.",
      copy: [
        "Ich bin AI-native Developer und Designer. CodeFlow Studio verbindet modernste Automatisierung mit menschlichem Feingefühl für Produkte, die futuristisch und persönlich wirken.",
        "Ich arbeite mit Gründer:innen, Agenturen und Teams, die schnell vorankommen wollen, ohne Craft einzubüßen. Lass uns etwas Lebendiges erschaffen.",
      ],
      stats: [
        { label: "Umgesetzte Projekte", value: "40+" },
        { label: "AI-Automationen live", value: "120+" },
        { label: "Ø Durchlaufzeit", value: "7 Tage" },
      ],
    },
    contact: {
      eyebrow: "Lass uns bauen",
      title: "Bereit für eine Website, die vom ersten Scroll an begeistert?",
      copy: "Schick mir deine Idee, Zielgruppe und Timeline. Innerhalb von 24h melde ich mich mit dem kostenlosen Preview-Konzept und den nächsten Schritten.",
      calendar: "Discovery-Call buchen",
    },
    footer: {
      copy: "© CodeFlow Studio. Mit Leidenschaft und AI gebaut.",
      backToTop: "Zurück nach oben",
    },
  },
};

const setActiveLanguage = (lang) => {
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.dataset.i18n;
    const value = getTranslation(key, lang);
    if (typeof value === "string") {
      el.textContent = value;
    }
  });
};

const getTranslation = (key, lang) => {
  return key.split(".").reduce((acc, part) => {
    if (acc && Object.prototype.hasOwnProperty.call(acc, part)) {
      return acc[part];
    }
    return null;
  }, translations[lang]);
};

const initLanguageSwitcher = () => {
  const buttons = document.querySelectorAll(".lang-button");
  let currentLang = "en";
  setActiveLanguage(currentLang);

  buttons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.dataset.lang;
      if (!lang || lang === currentLang) return;
      currentLang = lang;
      buttons.forEach((button) => button.classList.toggle("is-active", button.dataset.lang === lang));
      setActiveLanguage(lang);
    });
  });
};

const initRevealObserver = () => {
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("is-visible");
          observer.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.2,
    },
  );

  document.querySelectorAll(".section").forEach((section) => observer.observe(section));
};

const initConstellation = () => {
  const canvas = document.getElementById("constellation");
  if (!canvas) return;
  const ctx = canvas.getContext("2d");
  const particleCount = 80;
  const particles = [];
  const pointer = { x: 0, y: 0, active: false };

  const resize = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  };

  const createParticle = () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    vx: (Math.random() - 0.5) * 0.4,
    vy: (Math.random() - 0.5) * 0.4,
    radius: Math.random() * 1.8 + 0.6,
  });

  const updateParticles = () => {
    particles.forEach((p) => {
      p.x += p.vx;
      p.y += p.vy;

      if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
      if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

      if (pointer.active) {
        const dx = p.x - pointer.x;
        const dy = p.y - pointer.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        const influence = 140;
        if (dist < influence && dist > 0) {
          const force = (influence - dist) / influence;
          p.vx += (dx / dist) * force * 0.03;
          p.vy += (dy / dist) * force * 0.03;
        }
      }
    });
  };

  const drawParticles = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach((p) => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
      ctx.fillStyle = "rgba(140,255,215,0.55)";
      ctx.fill();
    });

    for (let i = 0; i < particles.length; i += 1) {
      for (let j = i + 1; j < particles.length; j += 1) {
        const p1 = particles[i];
        const p2 = particles[j];
        const dx = p1.x - p2.x;
        const dy = p1.y - p2.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 120) {
          const opacity = 1 - dist / 120;
          ctx.strokeStyle = `rgba(91,141,255,${opacity * 0.35})`;
          ctx.lineWidth = 0.8;
          ctx.beginPath();
          ctx.moveTo(p1.x, p1.y);
          ctx.lineTo(p2.x, p2.y);
          ctx.stroke();
        }
      }
    }

    if (pointer.active) {
      particles.forEach((p) => {
        const dx = p.x - pointer.x;
        const dy = p.y - pointer.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 160) {
          const opacity = 1 - dist / 160;
          ctx.strokeStyle = `rgba(255,106,206,${opacity * 0.6})`;
          ctx.lineWidth = 0.9;
          ctx.beginPath();
          ctx.moveTo(pointer.x, pointer.y);
          ctx.lineTo(p.x, p.y);
          ctx.stroke();
        }
      });
    }
  };

  const loop = () => {
    updateParticles();
    drawParticles();
    requestAnimationFrame(loop);
  };

  resize();
  window.addEventListener("resize", resize);
  window.addEventListener("mousemove", (event) => {
    pointer.x = event.clientX;
    pointer.y = event.clientY;
    pointer.active = true;
  });
  window.addEventListener("mouseleave", () => {
    pointer.active = false;
  });

  for (let i = 0; i < particleCount; i += 1) {
    particles.push(createParticle());
  }
  loop();
};

const initNavigationToggle = () => {
  const toggle = document.querySelector(".nav-toggle");
  const navWrapper = document.querySelector(".nav-wrapper");
  if (!toggle || !navWrapper) return;

  const navLinks = navWrapper.querySelectorAll(".nav a");
  const isMobile = () => window.innerWidth <= 1024;

  const closeMenu = () => {
    document.body.classList.remove("nav-open");
    toggle.setAttribute("aria-expanded", "false");
    if (isMobile()) {
      navWrapper.setAttribute("aria-hidden", "true");
    } else {
      navWrapper.removeAttribute("aria-hidden");
    }
  };

  const openMenu = () => {
    document.body.classList.add("nav-open");
    toggle.setAttribute("aria-expanded", "true");
    if (isMobile()) {
      navWrapper.setAttribute("aria-hidden", "false");
    }
  };

  toggle.addEventListener("click", () => {
    if (document.body.classList.contains("nav-open")) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  navLinks.forEach((link) => {
    link.addEventListener("click", () => {
      if (document.body.classList.contains("nav-open")) {
        closeMenu();
      }
    });
  });

  document.addEventListener("keydown", (event) => {
    if (event.key === "Escape" && document.body.classList.contains("nav-open")) {
      closeMenu();
      toggle.focus();
    }
  });

  window.addEventListener("resize", () => {
    if (window.innerWidth > 1024 && document.body.classList.contains("nav-open")) {
      closeMenu();
    }
    if (isMobile()) {
      navWrapper.setAttribute("aria-hidden", document.body.classList.contains("nav-open") ? "false" : "true");
    } else {
      navWrapper.removeAttribute("aria-hidden");
    }
  });

  if (isMobile()) {
    navWrapper.setAttribute("aria-hidden", "true");
  } else {
    navWrapper.removeAttribute("aria-hidden");
  }
};

const init = () => {
  initLanguageSwitcher();
  initNavigationToggle();
  initRevealObserver();
  initConstellation();
};

document.addEventListener("DOMContentLoaded", init);
