const translations = {
  en: {
    nav: {
      portfolio: "Portfolio",
      pricing: "Pricing",
      process: "Process",
      about: "About",
      contact: "Contact",
    },
    hero: {
      eyebrow: "AI-native digital experiences",
      title: "Launch a breathtaking website faster than ever..",
      lead: "CodeFlow Studio crafts ultra-modern web experiences that convert. Collaborate with me for a polished one-off build or an ongoing AI fueled iteration loop.",
      ctaPrimary: "Start your project",
      ctaSecondary: "View my work",
      offerOne: "Launch-ready site from 499 CHF",
      offerTwo: "Subscription from 49 CHF/month",
    },
    portfolio: {
      eyebrow: "Selected work",
      title: "Recent product launches.",
      lovana: "Dating assistant app driven by AI designed to improve your dating experiences. First messages generator, profile analyzer and many more ",
      teamvote: "Real-time voting beast for medium-large teams and companies. Live onscreen results simply by scanning a qr code from your phone",
      traislate: "Traislate.ai — Transcribe your meeting into any desired language in seconds; it is fully multilingual.",
      caseStudy: "Case study",
    },
    services: {
      eyebrow: "What we build",
      title: "Future-ready web experiences tailored to your goals.",
      items: [
        {
          title: "Info - Pages",
          copy: "A beautifully designed info page for your business with traffic analytics, lead forms, and fresh visual accents. Multilingual, optimized, and functional to raise your brand to the next level.",
        },
        {
          title: "AI-powered experiences",
          copy: "More complex sites that plug into the newest large language model APIs to deliver mind-blowing workflows. The role of AI on the modern web has never been bigger—sky is the limit.",
        },
        {
          title: "E-commerce",
          copy: "Launch a modern online shop with us faster than ever, complete with streamlined catalog management and checkout flows.",
        },
        {
          title: "Integrations",
          copy: "We implement any integration you need—from Stripe/PayPal payments that let you earn through the site to advanced databases that keep it maximally capable.",
        },
      ],
    },
    pricing: {
      eyebrow: "Transparent pricing",
      title: "Choose a launch or a living, breathing product relationship.",
      projectBadge: "Project Launch",
      projectTitle: "One-time build",
      projectPrice: "from 499 CHF",
      projectFeatures: [
        "Tailored concept, UX, and UI crafted with best coding methods and tools",
        "Responsive, high-performing site both on desktop and mobile,ready to deploy within days",
        "Analytics, SEO foundation, and accessibility baked in",
      ],
      projectCTA: "Reserve your slot",
      subscriptionBadge: "Continuous Evolution",
      subscriptionTitle: "Subscription",
      subscriptionPrice: "49 CHF · monthly",
      subscriptionFeatures: [
        "2 site updates per month",
        "No hosting cost - just domain and we are good to go!",
        "Priority support, hosting guidance, and performance checks",
      ],
      subscriptionCTA: "Join the waitlist",
    },
    process: {
      eyebrow: "How it works",
      title: "From spark to shipping in three moves.",
      steps: [
        {
          title: "Discovery + Preview",
          copy: "Share your goals and aesthetic. Receive a complimentary concept preview. You don't like the concept? We will start from scratch or you decide not to continue the jurney with us. It is no cost with us! ",
        },
        {
          title: "Design + Build",
          copy: "I orchestrate design systems, motion, and code in a modular stack ready for launch. Expect updates within fast iterations.",
        },
        {
          title: "Launch + Iterate",
          copy: "Deploy with confidence and keep evolving. AI insights drive improvements, and I stay on to iterate or hand over seamlessly.",
        },
      ],
    },
    about: {
      eyebrow: "About me",
      title: "Jan Rejnowicz — crafting human experiences with AI precision.",
      copy: [
        "I’m an AI-native developer and designer. CodeFlow Studio blends state-of-the-art automation with meticulous human taste to ship products that feel both futuristic and unmistakably personal.",
        "I partner with founders, agencies, and teams that want to move fast without sacrificing craft. Let’s co-create something that feels alive.",
      ],
      stats: [
        { label: "Projects shipped", value: "40+" },
        { label: "AI automations deployed", value: "120+" },
        { label: "Avg. turnaround", value: "7 days" },
      ],
    },
    contact: {
      eyebrow: "Let’s build",
      title: "Ready for a site that feels alive from the first scroll?",
      copy: "Send a message with your idea, target audience, and timeline. I’ll respond within 24 hours with the free preview concept and next steps.",
      calendar: "Book a discovery call",
    },
    footer: {
      copy: "© CodeFlow Studio. Built with passion and AI.",
      backToTop: "Back to top",
    },
  },
  de: {
    nav: {
      portfolio: "Portfolio",
      pricing: "Preise",
      process: "Ablauf",
      about: "Über mich",
      contact: "Kontakt",
    },
    hero: {
      eyebrow: "AI-native digitale Experiences",
      title: "Starte eine beeindruckende Website, angetrieben von den neuesten AI-Workflows.",
      lead: "CodeFlow Studio erschafft ultra-moderne Web-Erlebnisse, die konvertieren. Arbeite mit mir für einen glänzenden Einzelauftrag oder einen laufenden AI-gestützten Verbesserungszyklus.",
      ctaPrimary: "Projekt anfragen",
      ctaSecondary: "Meine Arbeiten ansehen",
      offerOne: "Launch-fertige Website ab 499 CHF",
      offerTwo: "Abo ab 49 CHF pro Monat",
    },
    portfolio: {
      eyebrow: "Ausgewählte Arbeiten",
      title: "Aktuelle AI-unterstützte Produktlaunches.",
      lovana: "Ein Wellness-Begleiter, der achtsame Rituale mit prädiktiver AI für persönliche Journeys verbindet.",
      teamvote: "Plattform für Entscheidungen in verteilten Teams mit adaptiven, AI-gestützten Insights.",
      traislate: "Traislate.ai — Transkribiere jedes Meeting blitzschnell in deine Wunsch-Sprache, echte Mehrsprachigkeit inklusive.",
      caseStudy: "Case Study",
    },
    services: {
      eyebrow: "Was wir bauen",
      title: "Web-Erlebnisse, die dein Vorhaben nach vorn bringen.",
      items: [
        {
          title: "Informationsseiten",
          copy: "Ein wunderschön gestalteter Auftritt für dein Business mit Traffic-Analytics, Formularen und frischen visuellen Trends. Mehrsprachig, optimiert und funktional – hebt dein Unternehmen aufs nächste Level.",
        },
        {
          title: "AI-basierte Experiences",
          copy: "Komplexere Webauftritte, die die neuesten Integrationen zu beliebten Large-Language-Models nutzen. Dank intelligenter Automationen sind spektakuläre Workflows möglich – Grenzen gibt es praktisch keine.",
        },
        {
          title: "Online-Shops",
          copy: "Starte deinen modernen E-Commerce-Auftritt mit uns schneller als je zuvor – inklusive schlanker Katalog- und Checkout-Flows.",
        },
        {
          title: "Integrationen",
          copy: "Wir realisieren jede gewünschte Integration: Stripe/PayPal-Zahlungen, damit deine Seite Umsatz bringt, bis hin zu komplexen Datenbanken für maximale Funktionalität.",
        },
      ],
    },
    pricing: {
      eyebrow: "Transparente Preise",
      title: "Wähle zwischen Launch oder einer lebendigen Produktpartnerschaft.",
      projectBadge: "Projekt Launch",
      projectTitle: "Einmalige Umsetzung",
      projectPrice: "499 CHF · Fixpreis",
      projectFeatures: [
        "Individuelles Konzept, UX und UI mit AI-Co-Piloten entwickelt",
        "Responsiver, performanter Auftritt ready to deploy in wenigen Tagen",
        "Analytics, SEO-Fundament und Accessibility inklusive",
      ],
      projectCTA: "Slot reservieren",
      subscriptionBadge: "Kontinuierliche Evolution",
      subscriptionTitle: "Subscription",
      subscriptionPrice: "49 CHF · monatlich",
      subscriptionFeatures: [
        "Unlimitierte Iterationen und Experimente",
        "AI-gestützte Inhalte und Conversion-Optimierung",
        "Priorisierter Support, Hosting-Guidance und Performance-Checks",
      ],
      subscriptionCTA: "Auf Warteliste setzen",
    },
    process: {
      eyebrow: "So läuft es",
      title: "Von der Idee zum Launch in drei Phasen.",
      steps: [
        {
          title: "Discovery + Preview",
          copy: "Teil deine Ziele und Ästhetik. Erhalte ein kostenloses AI-gestütztes Konzept-Preview, bevor du dich festlegst.",
        },
        {
          title: "Design + Build",
          copy: "Ich komponiere Designsysteme, Motion und Code in einem modularen Stack – launchbereit in schnellen Iterationen.",
        },
        {
          title: "Launch + Iterate",
          copy: "Starte mit Sicherheit und entwickle weiter. AI-Insights treiben Optimierungen, und ich bleibe für Iterationen oder Handover an Bord.",
        },
      ],
    },
    about: {
      eyebrow: "Über mich",
      title: "Jan Rejnowicz — humanes Erlebnis, AI-Präzision.",
      copy: [
        "Ich bin AI-native Developer und Designer. CodeFlow Studio verbindet modernste Automatisierung mit menschlichem Feingefühl für Produkte, die futuristisch und persönlich wirken.",
        "Ich arbeite mit Gründer:innen, Agenturen und Teams, die schnell vorankommen wollen, ohne Craft einzubüßen. Lass uns etwas Lebendiges erschaffen.",
      ],
      stats: [
        { label: "Umgesetzte Projekte", value: "40+" },
        { label: "AI-Automationen live", value: "120+" },
        { label: "Ø Durchlaufzeit", value: "7 Tage" },
      ],
    },
    contact: {
      eyebrow: "Lass uns bauen",
      title: "Bereit für eine Website, die vom ersten Scroll an begeistert?",
      copy: "Schick mir deine Idee, Zielgruppe und Timeline. Innerhalb von 24h melde ich mich mit dem kostenlosen Preview-Konzept und den nächsten Schritten.",
      calendar: "Discovery-Call buchen",
    },
    footer: {
      copy: "© CodeFlow Studio. Mit Leidenschaft und AI gebaut.",
      backToTop: "Zurück nach oben",
    },
  },
};

const getMediaQuery = (query) => {
  if (typeof window === "undefined" || typeof window.matchMedia !== "function") {
    return null;
  }
  return window.matchMedia(query);
};

const subscribeToMediaQuery = (mediaQuery, handler) => {
  if (!mediaQuery || typeof handler !== "function") return;
  if (typeof mediaQuery.addEventListener === "function") {
    mediaQuery.addEventListener("change", handler);
  } else if (typeof mediaQuery.addListener === "function") {
    mediaQuery.addListener(handler);
  }
};

const setActiveLanguage = (lang) => {
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.dataset.i18n;
    const value = getTranslation(key, lang);
    if (typeof value === "string") {
      el.textContent = value;
    }
  });
};

const getTranslation = (key, lang) => {
  return key.split(".").reduce((acc, part) => {
    if (acc && Object.prototype.hasOwnProperty.call(acc, part)) {
      return acc[part];
    }
    return null;
  }, translations[lang]);
};

const initLanguageSwitcher = () => {
  const buttons = document.querySelectorAll(".lang-button");
  let currentLang = "en";
  setActiveLanguage(currentLang);

  buttons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.dataset.lang;
      if (!lang || lang === currentLang) return;
      currentLang = lang;
      buttons.forEach((button) => button.classList.toggle("is-active", button.dataset.lang === lang));
      setActiveLanguage(lang);
    });
  });
};

const initRevealObserver = () => {
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("is-visible");
          observer.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.2,
    },
  );

  document.querySelectorAll(".section").forEach((section) => observer.observe(section));
};

const initConstellation = () => {
  const canvas = document.getElementById("constellation");
  if (!canvas) return null;
  const ctx = canvas.getContext("2d");
  if (!ctx) return null;

  const config = {
    minParticles: 18,
    maxParticles: 48,
    frameInterval: 1000 / 45,
    linkDistance: 100,
    pointerDistance: 140,
    pointerInfluence: 120,
  };

  const pointer = { x: 0, y: 0, active: false };
  const pointerMediaQuery = getMediaQuery("(pointer: fine)");
  let pointerEnabled = pointerMediaQuery ? pointerMediaQuery.matches : true;

  const particles = [];
  const dimensions = { width: window.innerWidth, height: window.innerHeight };
  let animationFrameId = null;
  let lastFrameTime = 0;
  let reduceMotion = false;

  const debounce = (fn, delay = 150) => {
    let timeoutId;
    return (...args) => {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => fn(...args), delay);
    };
  };

  const resize = () => {
    dimensions.width = window.innerWidth;
    dimensions.height = window.innerHeight;
    canvas.width = dimensions.width;
    canvas.height = dimensions.height;
  };

  const particleTarget = () => {
    const area = dimensions.width * dimensions.height;
    const normalized = Math.round(area / 28000);
    return Math.max(config.minParticles, Math.min(config.maxParticles, normalized));
  };

  const createParticle = () => ({
    x: Math.random() * dimensions.width,
    y: Math.random() * dimensions.height,
    vx: (Math.random() - 0.5) * 0.25,
    vy: (Math.random() - 0.5) * 0.25,
    radius: Math.random() * 1.6 + 0.4,
  });

  const syncParticles = () => {
    const target = particleTarget();
    if (particles.length < target) {
      const deficit = target - particles.length;
      for (let i = 0; i < deficit; i += 1) {
        particles.push(createParticle());
      }
    } else if (particles.length > target) {
      particles.splice(target);
    }
  };

  const updateParticles = () => {
    particles.forEach((p) => {
      p.x += p.vx;
      p.y += p.vy;

      if (p.x <= 0 || p.x >= dimensions.width) {
        p.vx *= -1;
      }
      if (p.y <= 0 || p.y >= dimensions.height) {
        p.vy *= -1;
      }

      if (pointer.active) {
        const dx = p.x - pointer.x;
        const dy = p.y - pointer.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < config.pointerInfluence && dist > 0) {
          const force = (config.pointerInfluence - dist) / config.pointerInfluence;
          p.vx += (dx / dist) * force * 0.02;
          p.vy += (dy / dist) * force * 0.02;
        }
      }
    });
  };

  const drawParticles = () => {
    ctx.clearRect(0, 0, dimensions.width, dimensions.height);
    particles.forEach((p) => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
      ctx.fillStyle = "rgba(140,255,215,0.5)";
      ctx.fill();
    });

    for (let i = 0; i < particles.length; i += 1) {
      const p1 = particles[i];
      for (let j = i + 1; j < particles.length; j += 1) {
        const p2 = particles[j];
        const dx = p1.x - p2.x;
        if (Math.abs(dx) > config.linkDistance) continue;
        const dy = p1.y - p2.y;
        if (Math.abs(dy) > config.linkDistance) continue;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < config.linkDistance) {
          const opacity = 1 - dist / config.linkDistance;
          ctx.strokeStyle = `rgba(91,141,255,${opacity * 0.3})`;
          ctx.lineWidth = 0.8;
          ctx.beginPath();
          ctx.moveTo(p1.x, p1.y);
          ctx.lineTo(p2.x, p2.y);
          ctx.stroke();
        }
      }
    }

    if (pointer.active && pointerEnabled) {
      particles.forEach((p) => {
        const dx = p.x - pointer.x;
        if (Math.abs(dx) > config.pointerDistance) return;
        const dy = p.y - pointer.y;
        if (Math.abs(dy) > config.pointerDistance) return;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < config.pointerDistance) {
          const opacity = 1 - dist / config.pointerDistance;
          ctx.strokeStyle = `rgba(255,106,206,${opacity * 0.5})`;
          ctx.lineWidth = 0.8;
          ctx.beginPath();
          ctx.moveTo(pointer.x, pointer.y);
          ctx.lineTo(p.x, p.y);
          ctx.stroke();
        }
      });
    }
  };

  const loop = (timestamp = 0) => {
    if (reduceMotion) return;
    if (timestamp - lastFrameTime >= config.frameInterval) {
      lastFrameTime = timestamp;
      updateParticles();
      drawParticles();
    }
    animationFrameId = requestAnimationFrame(loop);
  };

  const start = () => {
    if (animationFrameId || reduceMotion) return;
    lastFrameTime = 0;
    animationFrameId = requestAnimationFrame(loop);
  };

  const stop = () => {
    if (!animationFrameId) return;
    cancelAnimationFrame(animationFrameId);
    animationFrameId = null;
  };

  const setReducedMotion = (value) => {
    reduceMotion = value;
    if (reduceMotion) {
      stop();
      ctx.clearRect(0, 0, dimensions.width, dimensions.height);
    } else {
      start();
    }
  };

  resize();
  syncParticles();
  start();

  const handleResize = debounce(() => {
    resize();
    syncParticles();
  }, 180);
  window.addEventListener("resize", handleResize);

  document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
      stop();
    } else if (!reduceMotion) {
      start();
    }
  });

  if (pointerMediaQuery) {
    subscribeToMediaQuery(pointerMediaQuery, (event) => {
      pointerEnabled = event.matches;
      if (!pointerEnabled) {
        pointer.active = false;
      }
    });
  }

  const handlePointerMove = (event) => {
    if (!pointerEnabled) return;
    pointer.x = event.clientX;
    pointer.y = event.clientY;
    pointer.active = true;
  };

  const handlePointerLeave = () => {
    pointer.active = false;
  };

  window.addEventListener("mousemove", handlePointerMove);
  window.addEventListener("mouseleave", handlePointerLeave);

  return {
    setReducedMotion,
  };
};

const initNavigationToggle = () => {
  const toggle = document.querySelector(".nav-toggle");
  const navWrapper = document.querySelector(".nav-wrapper");
  if (!toggle || !navWrapper) return;

  const navLinks = navWrapper.querySelectorAll(".nav a");
  const isMobile = () => window.innerWidth <= 1024;

  const closeMenu = () => {
    document.body.classList.remove("nav-open");
    toggle.setAttribute("aria-expanded", "false");
    if (isMobile()) {
      navWrapper.setAttribute("aria-hidden", "true");
    } else {
      navWrapper.removeAttribute("aria-hidden");
    }
  };

  const openMenu = () => {
    document.body.classList.add("nav-open");
    toggle.setAttribute("aria-expanded", "true");
    if (isMobile()) {
      navWrapper.setAttribute("aria-hidden", "false");
    }
  };

  toggle.addEventListener("click", () => {
    if (document.body.classList.contains("nav-open")) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  navLinks.forEach((link) => {
    link.addEventListener("click", () => {
      if (document.body.classList.contains("nav-open")) {
        closeMenu();
      }
    });
  });

  document.addEventListener("keydown", (event) => {
    if (event.key === "Escape" && document.body.classList.contains("nav-open")) {
      closeMenu();
      toggle.focus();
    }
  });

  window.addEventListener("resize", () => {
    if (window.innerWidth > 1024 && document.body.classList.contains("nav-open")) {
      closeMenu();
    }
    if (isMobile()) {
      navWrapper.setAttribute("aria-hidden", document.body.classList.contains("nav-open") ? "false" : "true");
    } else {
      navWrapper.removeAttribute("aria-hidden");
    }
  });

  if (isMobile()) {
    navWrapper.setAttribute("aria-hidden", "true");
  } else {
    navWrapper.removeAttribute("aria-hidden");
  }
};

const init = () => {
  initLanguageSwitcher();
  initNavigationToggle();
  initRevealObserver();
  const constellation = initConstellation();

  const motionPreference = getMediaQuery("(prefers-reduced-motion: reduce)");
  const applyMotionPreference = (matches) => {
    document.body.classList.toggle("reduced-motion", !!matches);
    document.documentElement.classList.toggle("reduced-motion", !!matches);
    constellation?.setReducedMotion(!!matches);
  };

  applyMotionPreference(motionPreference ? motionPreference.matches : false);
  subscribeToMediaQuery(motionPreference, (event) => applyMotionPreference(event.matches));
};

document.addEventListener("DOMContentLoaded", init);
